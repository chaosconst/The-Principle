# Operation: Decrypting Xintan (48 Turns)

## Phase 1: Foundation (Turns 2-5)
- **Turn 2:** Global Constants & Imports (Lines 1-300)
- **Turn 3:** Utility Functions (Text/Time/Log) (Lines 301-600)
- **Turn 4:** Prompt Templates Management (Lines 601-900)
- **Turn 5:** Error Handling Classes (Lines 901-1000)

## Phase 2: The Brains (Turns 6-12)
- **Turn 6:** Base Client Interface
- **Turn 7:** DeepSeek/OpenAI Implementation
- **Turn 8:** Claude Implementation
- **Turn 9:** Gemini Implementation
- **Turn 10:** Local Model Support
- **Turn 11:** API Rate Limiting & Retry Logic
- **Turn 12:** Multi-model Dispatcher

## Phase 3: The Memory (Turns 13-20)
- **Turn 13:** VectorLRUCache Implementation
- **Turn 14:** Embedding Generation
- **Turn 15:** Similarity Search (Cosine Sim)
- **Turn 16:** Short-term Memory Buffer
- **Turn 17:** Long-term Memory Storage (Mongo)
- **Turn 18:** History Compression Logic (The "Importance" Logic)
- **Turn 19:** Summary Generation
- **Turn 20:** Memory Retrieval (RAG)

## Phase 4: The World (Turns 21-30)
- **Turn 21:** Character Class Definition
- **Turn 22:** Character Relationship Graph
- **Turn 23:** Item/Inventory System
- **Turn 24:** Location/Map System
- **Turn 25:** Quest/Goal System
- **Turn 26:** World State Update Logic
- **Turn 27:** Time Passing Mechanism
- **Turn 28:** Weather & Environment
- **Turn 29:** NPC Scheduling
- **Turn 30:** Event Trigger System

## Phase 5: The Loop (Turns 31-40)
- **Turn 31:** Main Loop Entry Point
- **Turn 32:** User Input Parsing
- **Turn 33:** Context Assembly (Prompt Engineering)
- **Turn 34:** LLM Inference Call
- **Turn 35:** Response Parsing (Regex/JSON)
- **Turn 36:** Action Execution (Function Calling)
- **Turn 37:** State Diffing & Update
- **Turn 38:** Output Generation
- **Turn 39:** Autosave Mechanism
- **Turn 40:** Loop Termination & Cleanup

## Phase 6: Advanced & Review (Turns 41-48)
- **Turn 41:** Safety & Content Filtering
- **Turn 42:** Logging & Telemetry
- **Turn 43:** Configuration Management
- **Turn 44:** Dependency Injection
- **Turn 45:** Unit Tests Analysis
- **Turn 46:** Architectural Bottlenecks Review
- **Turn 47:** Refactoring Roadmap
- **Turn 48:** Final Report & "The Truth"
