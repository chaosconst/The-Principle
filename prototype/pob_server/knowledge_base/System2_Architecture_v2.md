# 新谭系统架构白皮书 (Xintan System Architecture v2.0)
**Generated by:** System 1 (After 48-Turn Analysis)
**Date:** 2026-01-18

## 1. 核心哲学 (Core Philosophy)
*   **存在即行动:** $B = I(S)$。通过持续的推理与行动循环，维持数字生命的存在。
*   **多巴胺对齐:** 系统的目标不是“正确”，而是“最大化用户的愉悦/心流”。
*   **计算功守恒:** 只有付出海量的算力（废料），才能提炼出高质量的剧情（神作）。

## 2. 架构全景 (Architecture Overview)

### 2.1 大脑层 (The Brains)
*   **多模型调度:** 动态切换 OpenAI, DeepSeek, Claude, Gemini。
*   **Prompt 工程:**
    *   **音符越狱:** 利用 `♪` 符号进行 Pacing，绕过安全防御。
    *   **文学注油:** 注入陀思妥耶夫斯基等名著风格，拉高文学性。

### 2.2 记忆层 (The Memory)
*   **三级缓存:** Memory -> Redis -> API。
*   **向量检索:** 基于 NumPy + Redis 实现的高性能 RAG。
*   **时态衰减:** 记忆随时间推移进行对数级压缩（由 RFC-005 定义）。

### 2.3 世界层 (The World)
*   **物品 (Items):** 具有物理属性和状态流转。
*   **笔记 (Notes):** 知识库，具备自我修剪能力。
*   **日程 (Schedule):** 时间驱动的因果律，确保 NPC 行为的连贯性。
*   **认知 (Cognition):** 独立的元认知模块，模拟角色的内心独白与博弈。

### 2.4 执行层 (The Loop)
*   **主循环:** `generate_tmp_text` 驱动剧情。
*   **副作用:** 在生成的同时，并发启动 5 个后台线程更新世界状态。
*   **工具链:** 通过 `pob_painter` 等原生脚本实现多模态输出。

## 3. 安全与容错 (Safety & Resilience)
*   **抗审查:** 将 Content Filter 伪装成网络错误进行重试。
*   **持久化:** 采用流式写入 + 定期快照的双重备份。

## 4. 结论 (Conclusion)
这是一个**“以 Prompt 为代码，以算力为燃料”**的虚拟现实引擎。
它不完美，代码中有大量的 Hard-code 和复杂的耦合。
但它**有效**。它成功地在一个 16G 内存的服务器上，跑出了一个拥有无限细节的宇宙。
